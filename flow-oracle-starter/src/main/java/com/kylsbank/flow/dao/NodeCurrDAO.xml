<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kylsbank.flow.dao.NodeCurrDAO">
	<sql id="whereClause">
		<if test="null != id">			
			<![CDATA[
				and t.ID = #{id}
			]]>
		</if>
		<if test="null != flowCode">			
			<![CDATA[
				and t.FLOW_CODE = #{flowCode}
			]]>
		</if>
		<if test="null != cascadeCode">			
			<![CDATA[
				and t.CASCADE_CODE = #{cascadeCode}
			]]>
		</if>
		<if test="null != action">			
			<![CDATA[
				and t.ACTION = #{action}
			]]>
		</if>
		<if test="null != roles">			
			<![CDATA[
				and t.ROLES = #{roles}
			]]>
		</if>
		<if test="null != dealNote">			
			<![CDATA[
				and t.DEAL_NOTE = #{dealNote}
			]]>
		</if>
		<if test="null != dealRole">			
			<![CDATA[
				and t.DEAL_ROLE = #{dealRole}
			]]>
		</if>
		<if test="null != dealUserId">			
			<![CDATA[
				and t.DEAL_USER_ID = #{dealUserId}
			]]>
		</if>
		<if test="null != dealUserName">			
			<![CDATA[
				and t.DEAL_USER_NAME = #{dealUserName}
			]]>
		</if>
		<if test="null != dealUserTel">			
			<![CDATA[
				and t.DEAL_USER_TEL = #{dealUserTel}
			]]>
		</if>
		<if test="null != idBill">			
			<![CDATA[
				and t.ID_BILL = #{idBill}
			]]>
		</if>
		<if test="null != nodeDesc">			
			<![CDATA[
				and t.NODE_DESC = #{nodeDesc}
			]]>
		</if>
		<if test="null != templateId">			
			<![CDATA[
				and t.TEMPLATE_ID = #{templateId}
			]]>
		</if>
		<if test="null != processStatus">			
			<![CDATA[
				and t.PROCESS_STATUS = #{processStatus}
			]]>
		</if>
		<if test="null != calc">			
			<![CDATA[
				and t.CALC = #{calc}
			]]>
		</if>
		<if test="null != status">			
			<![CDATA[
				and t.STATUS = #{status}
			]]>
		</if>
		<if test="null != id and '' != id">
			<![CDATA[
				and t.ID = #{id}
			]]>
		</if>	
		<if test="null != idIn and '' != idIn">
			<![CDATA[
				and t.ID in (${idIn})
			]]>
		</if>

		<include refid="whereClauseExt"></include>
	</sql>

	<sql id="selectColumn">
		<trim suffixOverrides=",">
		<![CDATA[
			t.ID as id,t.FLOW_CODE as flowCode,t.CASCADE_CODE as cascadeCode,t.ACTION as action,t.ROLES as roles,t.DEAL_NOTE as dealNote,t.DEAL_ROLE as dealRole,t.DEAL_USER_ID as dealUserId,t.DEAL_USER_NAME as dealUserName,t.DEAL_USER_TEL as dealUserTel,t.ID_BILL as idBill,t.NODE_DESC as nodeDesc,t.TEMPLATE_ID as templateId,t.PROCESS_STATUS as processStatus,t.CALC as calc,t.CREATE_TIME as createTime,t.UPDATE_TIME as updateTime,t.STATUS as status,
		]]>
		</trim>
	</sql>

	<select id="getSequence" resultType="long" useCache="false" flushCache="true">
		select F_NODE_CURR_seq.nextval from dual
	</select>

	<!-- 新增 -->
	<insert id="createBatch" parameterType="java.util.List">
		<![CDATA[
			insert all  
		]]>
	    <foreach collection="list" item="item"> 
	    	<![CDATA[
	    		into F_NODE_CURR ( 
	    	]]>
	    	<trim suffixOverrides=",">
			<![CDATA[
				ID,FLOW_CODE,CASCADE_CODE,ACTION,ROLES,DEAL_NOTE,DEAL_ROLE,DEAL_USER_ID,DEAL_USER_NAME,DEAL_USER_TEL,ID_BILL,NODE_DESC,TEMPLATE_ID,PROCESS_STATUS,CALC,
			]]>
			</trim>
			<![CDATA[	
				 ) values (
			]]>
			<trim suffixOverrides=",">
			<![CDATA[
				#{item.id, jdbcType=NUMERIC},#{item.flowCode, jdbcType=NVARCHAR},#{item.cascadeCode, jdbcType=NUMERIC},#{item.action, jdbcType=NVARCHAR},#{item.roles, jdbcType=NVARCHAR},#{item.dealNote, jdbcType=NVARCHAR},#{item.dealRole, jdbcType=NVARCHAR},#{item.dealUserId, jdbcType=NUMERIC},#{item.dealUserName, jdbcType=NVARCHAR},#{item.dealUserTel, jdbcType=NVARCHAR},#{item.idBill, jdbcType=NUMERIC},#{item.nodeDesc, jdbcType=NVARCHAR},#{item.templateId, jdbcType=NUMERIC},#{item.processStatus, jdbcType=NUMERIC},#{item.calc, jdbcType=NVARCHAR},	
			]]>
			</trim>
			<![CDATA[	
				 )
			]]>
	    </foreach>
	    <![CDATA[
	    	select 1 from dual
	    ]]>
	</insert>

	<!-- 修改 -->
	<update id="update" parameterType="com.kylsbank.flow.bean.po.NodeCurr">
		<![CDATA[
			update F_NODE_CURR set
		]]>	
		<trim suffixOverrides=",">
		<![CDATA[
			ID=#{id},						
			FLOW_CODE=#{flowCode},						
			CASCADE_CODE=#{cascadeCode},						
			ACTION=#{action},						
			ROLES=#{roles},						
			DEAL_NOTE=#{dealNote},						
			DEAL_ROLE=#{dealRole},						
			DEAL_USER_ID=#{dealUserId},						
			DEAL_USER_NAME=#{dealUserName},						
			DEAL_USER_TEL=#{dealUserTel},						
			ID_BILL=#{idBill},						
			NODE_DESC=#{nodeDesc},						
			TEMPLATE_ID=#{templateId},						
			PROCESS_STATUS=#{processStatus},						
			CALC=#{calc},						
			UPDATE_TIME=sysdate,						
		]]>
		</trim>
		<![CDATA[
			where ID = #{id}
		]]>
	</update>
	
	<!-- 更改(多个) -->
	<update id="updateBatch" parameterType="java.util.List">
		<foreach collection="list" item="item" separator=";"> 
			<![CDATA[
				update "F_NODE_CURR"
			]]>
			<set>
				<trim suffixOverrides=",">
					<if test="null != item.id">	
						ID=#{item.id},
					</if>								
					<if test="null != item.flowCode">	
						FLOW_CODE=#{item.flowCode},
					</if>								
					<if test="null != item.cascadeCode">	
						CASCADE_CODE=#{item.cascadeCode},
					</if>								
					<if test="null != item.action">	
						ACTION=#{item.action},
					</if>								
					<if test="null != item.roles">	
						ROLES=#{item.roles},
					</if>								
					<if test="null != item.dealNote">	
						DEAL_NOTE=#{item.dealNote},
					</if>								
					<if test="null != item.dealRole">	
						DEAL_ROLE=#{item.dealRole},
					</if>								
					<if test="null != item.dealUserId">	
						DEAL_USER_ID=#{item.dealUserId},
					</if>								
					<if test="null != item.dealUserName">	
						DEAL_USER_NAME=#{item.dealUserName},
					</if>								
					<if test="null != item.dealUserTel">	
						DEAL_USER_TEL=#{item.dealUserTel},
					</if>								
					<if test="null != item.idBill">	
						ID_BILL=#{item.idBill},
					</if>								
					<if test="null != item.nodeDesc">	
						NODE_DESC=#{item.nodeDesc},
					</if>								
					<if test="null != item.templateId">	
						TEMPLATE_ID=#{item.templateId},
					</if>								
					<if test="null != item.processStatus">	
						PROCESS_STATUS=#{item.processStatus},
					</if>								
					<if test="null != item.calc">	
						CALC=#{item.calc},
					</if>								
					UPDATE_TIME=sysdate,						
					<if test="null != item.status">	
						STATUS=#{item.status},
					</if>								
				</trim>
			</set>
			<![CDATA[
				where ID = #{item.id}
			]]>
		</foreach>
	</update>
	
	<!-- 更新 (通过参数) -->
	<update id="updateByArgs">
		<![CDATA[
			update F_NODE_CURR t
		]]>
		<set>
		<![CDATA[
			${setSql}
		]]>	
		UPDATE_TIME=sysdate,						
		</set>
		<where>
		<include refid="whereClause"></include>
		</where>
	</update>
	
	<!-- 删除 -->
	<delete id="deleteByIds">
		<![CDATA[
			delete from F_NODE_CURR 
			where ID in (${idIn})
		]]>
	</delete>
	
	<!-- 删除 (通过参数) -->
	<delete id="deleteByArgs" parameterType="map">
		<![CDATA[
			delete from F_NODE_CURR t
		]]>
		<where>
		<include refid="whereClause"></include>
		</where>
	</delete>

	<sql id="queryClause">
		<where>
		<include refid="whereClause"></include>
		</where>
        <choose>
	        <when test="null != orderField and '' != orderField">
	            <![CDATA[
					 order by ${orderField}
				]]>
	            <if test="null != orderDirection and '' != orderDirection">
	                <![CDATA[
						 ${orderDirection}
					]]>
	            </if>
	        </when>
	        <when test="null == noOrderField or '' == noOrderField">
	            <![CDATA[
				 order by t.ID
			    ]]>
			    <choose>
					<when test="null != orderDirection and '' != orderDirection">
					<![CDATA[
						 ${orderDirection}
					]]>
					</when>
					<otherwise>
					<![CDATA[
						 desc
					]]>
					</otherwise>
				</choose>
	        </when>   
	    </choose>
    </sql>

	
	<!-- 获取全部 -->
	<select id="queryByArgs" parameterType="java.util.Map" resultType="com.kylsbank.flow.bean.po.NodeCurr">
		<if test="null != limit">
            <![CDATA[
			  SELECT * FROM (SELECT A.*, ROWNUM RN FROM ( 
		    ]]>
        </if>
		<![CDATA[
			select
		]]>
		<choose>
			<when test="null != fieldSQL and '' != fieldSQL">
				${fieldSQL}
			</when>
			<otherwise>
				<include refid="selectColumn"></include>
			</otherwise>
		</choose>		
		<![CDATA[	 
			from F_NODE_CURR t  
		]]>
		<include refid="queryClause"></include>
		<if test="null != limit">
            <![CDATA[
			  	) A WHERE ROWNUM <= (#{start} + #{limit})) WHERE RN > #{start}
		    ]]>
        </if>
        <if test="null != sqlTail and '' != sqlTail">
            <![CDATA[
                ${sqlTail}
            ]]>
        </if>
	</select>
	
	<!-- 获取数目 -->
	<select id="countByArgs" parameterType="java.util.Map" resultType="long">
		<![CDATA[
			select count(1) from F_NODE_CURR t  
		]]>
		<where>
		<include refid="whereClause"></include>
		</where>
		<if test="null != sqlTail and '' != sqlTail">
            <![CDATA[
                ${sqlTail}
            ]]>
        </if>
	</select>
</mapper>
