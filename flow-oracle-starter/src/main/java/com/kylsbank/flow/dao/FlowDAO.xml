<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kylsbank.flow.dao.FlowDAO">
	<sql id="whereClause">
		<if test="null != id">			
			<![CDATA[
				and t.ID = #{id}
			]]>
		</if>
		<if test="null != code">			
			<![CDATA[
				and t.CODE = #{code}
			]]>
		</if>
		<if test="null != name">			
			<![CDATA[
				and t.NAME = #{name}
			]]>
		</if>
		<if test="null != cascadeCodeEntry">			
			<![CDATA[
				and t.CASCADE_CODE_ENTRY = #{cascadeCodeEntry}
			]]>
		</if>
		<if test="null != status">			
			<![CDATA[
				and t.STATUS = #{status}
			]]>
		</if>
		<if test="null != id and '' != id">
			<![CDATA[
				and t.ID = #{id}
			]]>
		</if>	
		<if test="null != idIn and '' != idIn">
			<![CDATA[
				and t.ID in (${idIn})
			]]>
		</if>

		<include refid="whereClauseExt"></include>
	</sql>

	<sql id="selectColumn">
		<trim suffixOverrides=",">
		<![CDATA[
			t.ID as id,t.CODE as code,t.NAME as name,t.CASCADE_CODE_ENTRY as cascadeCodeEntry,t.CREATE_TIME as createTime,t.UPDATE_TIME as updateTime,t.STATUS as status,
		]]>
		</trim>
	</sql>

	<select id="getSequence" resultType="long" useCache="false" flushCache="true">
		select F_FLOW_seq.nextval from dual
	</select>

	<!-- 新增 -->
	<insert id="createBatch" parameterType="java.util.List">
		<![CDATA[
			insert all  
		]]>
	    <foreach collection="list" item="item"> 
	    	<![CDATA[
	    		into F_FLOW ( 
	    	]]>
	    	<trim suffixOverrides=",">
			<![CDATA[
				ID,CODE,NAME,CASCADE_CODE_ENTRY,
			]]>
			</trim>
			<![CDATA[	
				 ) values (
			]]>
			<trim suffixOverrides=",">
			<![CDATA[
				#{item.id, jdbcType=NUMERIC},#{item.code, jdbcType=NVARCHAR},#{item.name, jdbcType=NVARCHAR},#{item.cascadeCodeEntry, jdbcType=NUMERIC},	
			]]>
			</trim>
			<![CDATA[	
				 )
			]]>
	    </foreach>
	    <![CDATA[
	    	select 1 from dual
	    ]]>
	</insert>

	<!-- 修改 -->
	<update id="update" parameterType="com.kylsbank.flow.bean.po.Flow">
		<![CDATA[
			update F_FLOW set
		]]>	
		<trim suffixOverrides=",">
		<![CDATA[
			ID=#{id},						
			CODE=#{code},						
			NAME=#{name},						
			CASCADE_CODE_ENTRY=#{cascadeCodeEntry},						
			UPDATE_TIME=sysdate,						
		]]>
		</trim>
		<![CDATA[
			where ID = #{id}
		]]>
	</update>
	
	<!-- 更改(多个) -->
	<update id="updateBatch" parameterType="java.util.List">
		<foreach collection="list" item="item" separator=";"> 
			<![CDATA[
				update "F_FLOW"
			]]>
			<set>
				<trim suffixOverrides=",">
					<if test="null != item.id">	
						ID=#{item.id},
					</if>								
					<if test="null != item.code">	
						CODE=#{item.code},
					</if>								
					<if test="null != item.name">	
						NAME=#{item.name},
					</if>								
					<if test="null != item.cascadeCodeEntry">	
						CASCADE_CODE_ENTRY=#{item.cascadeCodeEntry},
					</if>								
					UPDATE_TIME=sysdate,						
					<if test="null != item.status">	
						STATUS=#{item.status},
					</if>								
				</trim>
			</set>
			<![CDATA[
				where ID = #{item.id}
			]]>
		</foreach>
	</update>
	
	<!-- 更新 (通过参数) -->
	<update id="updateByArgs">
		<![CDATA[
			update F_FLOW t
		]]>
		<set>
		<![CDATA[
			${setSql}
		]]>	
		UPDATE_TIME=sysdate,						
		</set>
		<where>
		<include refid="whereClause"></include>
		</where>
	</update>
	
	<!-- 删除 -->
	<delete id="deleteByIds">
		<![CDATA[
			delete from F_FLOW 
			where ID in (${idIn})
		]]>
	</delete>
	
	<!-- 删除 (通过参数) -->
	<delete id="deleteByArgs" parameterType="map">
		<![CDATA[
			delete from F_FLOW t
		]]>
		<where>
		<include refid="whereClause"></include>
		</where>
	</delete>

	<sql id="queryClause">
		<where>
		<include refid="whereClause"></include>
		</where>
        <choose>
	        <when test="null != orderField and '' != orderField">
	            <![CDATA[
					 order by ${orderField}
				]]>
	            <if test="null != orderDirection and '' != orderDirection">
	                <![CDATA[
						 ${orderDirection}
					]]>
	            </if>
	        </when>
	        <when test="null == noOrderField or '' == noOrderField">
	            <![CDATA[
				 order by t.ID
			    ]]>
			    <choose>
					<when test="null != orderDirection and '' != orderDirection">
					<![CDATA[
						 ${orderDirection}
					]]>
					</when>
					<otherwise>
					<![CDATA[
						 desc
					]]>
					</otherwise>
				</choose>
	        </when>   
	    </choose>
    </sql>

	
	<!-- 获取全部 -->
	<select id="queryByArgs" parameterType="java.util.Map" resultType="com.kylsbank.flow.bean.po.Flow">
		<if test="null != limit">
            <![CDATA[
			  SELECT * FROM (SELECT A.*, ROWNUM RN FROM ( 
		    ]]>
        </if>
		<![CDATA[
			select
		]]>
		<choose>
			<when test="null != fieldSQL and '' != fieldSQL">
				${fieldSQL}
			</when>
			<otherwise>
				<include refid="selectColumn"></include>
			</otherwise>
		</choose>		
		<![CDATA[	 
			from F_FLOW t  
		]]>
		<include refid="queryClause"></include>
		<if test="null != limit">
            <![CDATA[
			  	) A WHERE ROWNUM <= (#{start} + #{limit})) WHERE RN > #{start}
		    ]]>
        </if>
        <if test="null != sqlTail and '' != sqlTail">
            <![CDATA[
                ${sqlTail}
            ]]>
        </if>
	</select>
	
	<!-- 获取数目 -->
	<select id="countByArgs" parameterType="java.util.Map" resultType="long">
		<![CDATA[
			select count(1) from F_FLOW t  
		]]>
		<where>
		<include refid="whereClause"></include>
		</where>
		<if test="null != sqlTail and '' != sqlTail">
            <![CDATA[
                ${sqlTail}
            ]]>
        </if>
	</select>
</mapper>
